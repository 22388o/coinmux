#!/usr/bin/env bundle exec ruby

require 'rbconfig'

def os
  @os ||= (
    host_os = RbConfig::CONFIG['host_os']
    case host_os
    when /mswin|msys|mingw|cygwin|bccwin|wince|emc/
      :windows
    when /darwin|mac os/
      :macosx
    when /linux/
      :linux
    when /solaris|bsd/
      :unix
    else
      raise Error::WebDriverError, "unknown os: #{host_os.inspect}"
    end
  )
end

args = []

if os == :macosx
  args << '-J-XstartOnFirstThread'
  args << '-J-Xdock:name=Coinmux'
end

env = {
  'COINMUX_ENV' => ENV['COINMUX_ENV'] || 'production'
}

args = %w(exec ruby) + args
if ARGV.length == 0
  args << './bin/coinmux_gui.rb'
  system(env, "bundle", *args)
else
  args << './bin/coinmux_cli.rb'
  args += ARGV
  system(env, "bundle", *args)
end

